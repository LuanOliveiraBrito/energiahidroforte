# ‚ö° Voltaris Energy# ‚ö° VOLTARIS ENERGY - Excel√™ncia na gest√£o de faturas de energia# ‚ö° VOLTARIS ENERGY - Excel√™ncia na gest√£o de faturas de energia



**Excel√™ncia na gest√£o de faturas de energia.**



Sistema ERP web para gest√£o de faturas de energia com workflow de aprova√ß√µes em m√∫ltiplos n√≠veis, pagamentos e controle financeiro com rastreabilidade total.Sistema ERP web completo desenvolvido para a empresa **Voltaris Energy**, focado na gest√£o de faturas de energia, aprova√ß√µes em m√∫ltiplos n√≠veis, pagamentos e controle financeiro com rastreabilidade total.Sistema ERP web completo desenvolvido para a empresa **Voltaris Energy**, focado na gest√£o de faturas de energia, aprova√ß√µes em m√∫ltiplos n√≠veis, pagamentos e controle financeiro com rastreabilidade total.



---



## Stack> **Vers√£o:** 2.0.0  > **Vers√£o:** 1.0.0  



| Camada     | Tecnologia                                      |> **√öltima atualiza√ß√£o:** 17 de Fevereiro de 2026  > **√öltima atualiza√ß√£o:** 14 de Fevereiro de 2026  

|------------|--------------------------------------------------|

| Frontend   | React 18 + Vite 5 + React Router 6              |> **Status:** ‚úÖ Em produ√ß√£o> **Status:** ‚úÖ Em produ√ß√£o

| Backend    | Node.js + Express 4 (porta 3001)                 |

| ORM        | Prisma 5 (schema-first + migrations)             |

| Banco      | PostgreSQL 16 (Docker)                           |

| Auth       | JWT + bcryptjs (RBAC com 5 perfis)               |------

| PDF        | pdf-lib + pdfjs-dist + QRCode + Tesseract.js OCR |

| Excel      | ExcelJS 4                                        |

| UI         | CSS customizado + React Icons + Chart.js 4       |

## üõ†Ô∏è Stack Tecnol√≥gica## üèóÔ∏è Arquitetura & Stack

---



## Perfis de Acesso (RBAC)

| Camada       | Tecnologia           | Detalhes                                        || Camada       | Tecnologia                          |

| Perfil         | Permiss√µes                                                        |

|----------------|-------------------------------------------------------------------||--------------|----------------------|-------------------------------------------------||--------------|-------------------------------------|

| ADMINISTRADOR  | Acesso total (cadastros, faturas, aprova√ß√µes, financeiro, usu√°rios)|

| ADMINISTRATIVO | Cadastros, lan√ßamento de faturas, relat√≥rios                      || **Frontend** | React 18 + Vite 5   | SPA com roteamento protegido                    || Frontend     | React 18 + Vite 5 + React Router 6 |

| GERENTE_ADM    | Cadastros, faturas, aprova√ß√µes, relat√≥rios                        |

| DIRETOR        | Cadastros, faturas, aprova√ß√µes, pagamentos, relat√≥rios            || **Backend**  | Node.js + Express 4 | API REST + serve frontend build                 || Backend      | Node.js + Express 4                 |

| FINANCEIRO     | Cadastros, faturas, financeiro/baixas, relat√≥rios                 |

| **Banco**    | PostgreSQL 16       | Docker container                                || ORM          | Prisma 5.10                         |

---

| **ORM**      | Prisma 5.10         | Schema-first com migrations                     || Banco        | PostgreSQL 16 (Docker)              |

## Funcionalidades

| **Auth**     | JWT + bcryptjs       | RBAC com 4 perfis                               || Auth         | JWT + bcryptjs                      |

- **Dashboard** ‚Äî KPIs financeiros + gr√°ficos interativos (Chart.js)

- **Cadastros** ‚Äî 6 entidades: Filiais, Fornecedores, UCs, Centros de Custo, Contas Cont√°beis, Naturezas| **PDF**      | pdf-lib + Multer     | Gera√ß√£o de Capa de Processo + upload de faturas  || Upload       | Multer (PDF, 10MB max)              |

- **Lan√ßamento de Faturas** ‚Äî Split view (PDF + formul√°rio), upload PDF, OCR autom√°tico (Energisa, Equatorial, CPFL, EDP), campos obrigat√≥rios com valida√ß√£o

- **Workflow** ‚Äî Lan√ßar ‚Üí Aprovar ‚Üí Liberar ‚Üí Baixar (com estorno), cada etapa registrada com usu√°rio + data| **Charts**   | Chart.js             | Dashboard interativo                            || UI           | CSS customizado + React Icons       |

- **Processo Completo** ‚Äî PDF unificado: Capa gerada (pdf-lib) + Pedido de Compras + Fatura anexa, com QR Code e hash HMAC-SHA256

- **Verifica√ß√£o Criptogr√°fica** ‚Äî P√°gina p√∫blica `/verificar` para validar autenticidade via hash| **UI**       | React Toastify       | Notifica√ß√µes elegantes                          || Charts       | Chart.js 4 + react-chartjs-2       |

- **Relat√≥rios** ‚Äî Filtros avan√ßados + exporta√ß√£o Excel/PDF

- **Auditoria** ‚Äî Logs completos de todas as opera√ß√µes| **Icons**    | React Icons (Fi)     | √çcones Feather consistentes                     || Toasts       | React Toastify 10                   |

- **Boleto** ‚Äî Leitura de c√≥digo de barras com extra√ß√£o autom√°tica de valor e vencimento

| Excel        | ExcelJS 4 (Capa de Processo)        |

---

---| Tunnel       | localtunnel (acesso externo)        |

## Modelos do Banco (Prisma)

| Container    | Docker (PostgreSQL)                 |

`User`, `Filial`, `Fornecedor`, `UnidadeConsumidora`, `CentroCusto`, `ContaContabil`, `Natureza`, `Fatura`, `AuditLog`

## üìÅ Estrutura do Projeto

Enums: `Role` (5 perfis), `FaturaStatus` (LANCADA ‚Üí APROVADA ‚Üí LIBERADA ‚Üí BAIXADA / ESTORNADA / REJEITADA)

---

---

```

## Estrutura

PROJETO HF - HIDROFORTE/## üìÅ Estrutura do Projeto

```

backend/‚îÇ

‚îú‚îÄ‚îÄ prisma/          # Schema, migrations, seeds

‚îú‚îÄ‚îÄ src/‚îú‚îÄ‚îÄ backend/```

‚îÇ   ‚îú‚îÄ‚îÄ config/      # database.js (PrismaClient)

‚îÇ   ‚îú‚îÄ‚îÄ middlewares/  # auth.middleware.js (JWT+RBAC), upload.middleware.js‚îÇ   ‚îú‚îÄ‚îÄ prisma/PROJETO HF - HIDROFORTE/

‚îÇ   ‚îú‚îÄ‚îÄ routes/      # auth, cadastro, fatura, workflow, dashboard,

‚îÇ   ‚îÇ                # relatorio, user, processoCompleto, capaProcesso,‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/                # Migra√ß√µes do banco de dados‚îú‚îÄ‚îÄ backend/

‚îÇ   ‚îÇ                # verificacao, boleto

‚îÇ   ‚îú‚îÄ‚îÄ utils/       # auditLog.js, verificacaoHash.js‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma              # Schema do Prisma‚îÇ   ‚îú‚îÄ‚îÄ prisma/

‚îÇ   ‚îî‚îÄ‚îÄ server.js    # Entry point (API + serve frontend build)

‚îú‚îÄ‚îÄ uploads/         # PDFs anexados‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seed.js                    # Seed de usu√°rios padr√£o‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma              # 9 modelos + 2 enums

‚îî‚îÄ‚îÄ .env             # DATABASE_URL, JWT_SECRET, PORT

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seedCentrosCusto.js        # Seed de centros de custo (JSON)‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ seed.js                    # 4 usu√°rios iniciais

frontend/

‚îú‚îÄ‚îÄ src/‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ seedImportar.js            # Seed unificado (C. Custo + Contas Cont√°beis)‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ migrations/

‚îÇ   ‚îú‚îÄ‚îÄ components/  # Layout, ReviewModal, ProcessoViewer, CapaProcesso, SearchableSelect

‚îÇ   ‚îú‚îÄ‚îÄ contexts/    # AuthContext (login, logout, RBAC)‚îÇ   ‚îú‚îÄ‚îÄ src/‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ 20260214160152_init/

‚îÇ   ‚îú‚îÄ‚îÄ pages/       # Login, Dashboard, Cadastros, LancarFatura, Aprovacoes,

‚îÇ   ‚îÇ                # Pagamentos, Financeiro, Relatorios, Usuarios‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ 20260214161813_add_bank_fields_and_payment/

‚îÇ   ‚îú‚îÄ‚îÄ services/    # api.js (Axios + interceptors)

‚îÇ   ‚îú‚îÄ‚îÄ styles/      # CSS modular (global + components + pages)‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.js            # Inst√¢ncia PrismaClient‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ 20260214163828_add_tipo_pagamento_fornecedor/

‚îÇ   ‚îî‚îÄ‚îÄ data/        # estadosCidades.js

‚îú‚îÄ‚îÄ dist/            # Build de produ√ß√£o (servido pelo backend)‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middlewares/‚îÇ   ‚îú‚îÄ‚îÄ src/

‚îî‚îÄ‚îÄ index.html

```‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth.middleware.js      # JWT + RBAC middleware‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/



---‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.js            # Conex√£o Prisma



## Como Rodar‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.js         # Login + /me‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middlewares/



### 1. Banco (Docker)‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cadastro.routes.js     # CRUD de cadastros (6 entidades) + pagina√ß√£o‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.middleware.js      # JWT + RBAC (4 perfis)



```bash‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ capaProcesso.routes.js # Gerar PDF Capa de Processo‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ upload.middleware.js    # Upload de PDFs

docker run --name hidroforte-postgres \

  -e POSTGRES_PASSWORD=hidroforte123 \‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.routes.js    # KPIs / Gr√°ficos‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/

  -e POSTGRES_DB=hidroforte_erp \

  -p 5432:5432 \‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fatura.routes.js       # Lan√ßamento de faturas‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.routes.js         # Login / Me (mensagens espec√≠ficas)

  -d postgres:16-alpine

```‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ processoCompleto.routes.js # PDF unificado (Capa + Fatura + Pedido)‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cadastro.routes.js     # CRUD de cadastros (6 entidades)



> Reiniciar ap√≥s reboot: `docker start hidroforte-postgres`‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ relatorio.routes.js    # Logs e relat√≥rios‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ capaProcesso.routes.js # Gerar Excel Capa de Processo



### 2. Backend‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.routes.js         # Gest√£o de usu√°rios‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard.routes.js    # KPIs / Gr√°ficos



```bash‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ workflow.routes.js     # Aprova√ß√£o/Libera√ß√£o/Baixa‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fatura.routes.js       # Lan√ßamento de faturas

cd backend

npm install‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ relatorio.routes.js    # Logs e relat√≥rios

npm run setup    # prisma generate + migrate + seed

npm run dev      # porta 3001 (nodemon)‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auditLog.js            # Registro de auditoria‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.routes.js         # Gest√£o de usu√°rios

```

‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.js                  # Entry point (API + serve frontend build)‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ workflow.routes.js     # Aprova√ß√£o/Libera√ß√£o/Baixa

`.env`:

```‚îÇ   ‚îú‚îÄ‚îÄ templates/‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/

DATABASE_URL="postgresql://postgres:hidroforte123@localhost:5432/hidroforte_erp"

JWT_SECRET="hidroforte-erp-secret-key-2026-mudar-em-producao"‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ capa-processo-modelo.xlsx  # Template Excel (legado)‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auditLog.js            # Registro de auditoria

JWT_EXPIRES_IN="8h"

PORT=3001‚îÇ   ‚îú‚îÄ‚îÄ uploads/                       # PDFs anexados √†s faturas‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ server.js                  # Entry point (API + serve frontend build)

```

‚îÇ   ‚îú‚îÄ‚îÄ .env                           # Configura√ß√µes sens√≠veis‚îÇ   ‚îú‚îÄ‚îÄ templates/

### 3. Frontend

‚îÇ   ‚îî‚îÄ‚îÄ package.json‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ capa-processo-modelo.xlsx  # Template Excel para Capa de Processo

```bash

cd frontend‚îÇ‚îÇ   ‚îú‚îÄ‚îÄ uploads/                       # PDFs anexados √†s faturas

npm install

npm run build    # gera dist/ servido pelo backend‚îú‚îÄ‚îÄ frontend/‚îÇ   ‚îú‚îÄ‚îÄ .env                           # Configura√ß√µes sens√≠veis

```

‚îÇ   ‚îú‚îÄ‚îÄ src/‚îÇ   ‚îî‚îÄ‚îÄ package.json

Acesse: `http://localhost:3001`

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/‚îÇ

---

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Layout.jsx             # Sidebar + Main (responsivo)‚îú‚îÄ‚îÄ frontend/

## Usu√°rios Padr√£o (Seed)

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProcessoViewer.jsx     # Visualizador fullscreen de PDF unificado‚îÇ   ‚îú‚îÄ‚îÄ src/

| Perfil         | Email                        | Senha    |

|----------------|------------------------------|----------|‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ReviewModal.jsx        # Modal de revis√£o + bot√£o Visualizar Processo‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/

| Administrador  | admin@voltaris.com.br        | admin123 |

| Operador       | operador@voltaris.com.br     | admin123 |‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contexts/‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Layout.jsx             # Sidebar + Main (responsivo)

| Diretoria      | diretoria@voltaris.com.br    | admin123 |

| Financeiro     | financeiro@voltaris.com.br   | admin123 |‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.jsx        # Contexto de autentica√ß√£o‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ReviewModal.jsx        # Modal de revis√£o + bot√£o Capa de Processo



---‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data/‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ contexts/



## LocalStorage Keys‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ estadosCidades.js      # Estados e cidades do Brasil‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.jsx        # Contexto de autentica√ß√£o



- `@voltaris:token` ‚Äî JWT token‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data/

- `@voltaris:user` ‚Äî Dados do usu√°rio logado

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.jsx              # Login com mensagens de erro inline‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ estadosCidades.js      # Estados e cidades do Brasil

---

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx          # KPIs + gr√°ficos interativos‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/

*Desenvolvido por Luan Oliveira*

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Cadastros.jsx          # 6 abas com pagina√ß√£o e busca‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Login.jsx              # Login com mensagens de erro inline

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LancarFatura.jsx       # Split view (PDF + formul√°rio)‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dashboard.jsx          # KPIs + gr√°ficos interativos

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Aprovacoes.jsx         # Fila de aprova√ß√£o (Diretoria)‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Cadastros.jsx          # 6 abas de cadastros

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Pagamentos.jsx         # Fila de libera√ß√£o (Financeiro)‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LancarFatura.jsx       # Split view (PDF + formul√°rio)

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Financeiro.jsx         # Baixas e confirma√ß√£o‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Aprovacoes.jsx         # Fila de aprova√ß√£o (Diretoria)

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Relatorios.jsx         # Logs + relat√≥rio com filtros‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Pagamentos.jsx         # Fila de libera√ß√£o (Financeiro)

‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Usuarios.jsx           # CRUD de usu√°rios (admin)‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Financeiro.jsx         # Baixas e confirma√ß√£o

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Relatorios.jsx         # Logs + relat√≥rio com filtros

‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.js                 # Axios (interceptors inteligentes)‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Usuarios.jsx           # CRUD de usu√°rios (admin)

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ styles/‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ global.css             # Entry point CSS (@imports modulares)‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api.js                 # Axios (interceptors inteligentes)

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ processoViewer.css     # Estilos do visualizador de processo‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ styles/

‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ global.css             # CSS global customizado

‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sidebar.css        # Sidebar / navega√ß√£o‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/

‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cards.css          # Cards de listagem‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatters.js          # CNPJ, moeda, data

‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tabs.css           # Abas de navega√ß√£o‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.jsx                    # Rotas protegidas por perfil

‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ forms.css          # Formul√°rios e inputs‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.jsx                   # Entry point + ToastContainer

‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ buttons.css        # Bot√µes e a√ß√µes‚îÇ   ‚îú‚îÄ‚îÄ dist/                          # Build de produ√ß√£o (servido pelo backend)

‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tables.css         # Tabelas de dados‚îÇ   ‚îú‚îÄ‚îÄ index.html

‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ badges.css         # Badges de status‚îÇ   ‚îú‚îÄ‚îÄ vite.config.js                 # Proxy /api e /uploads ‚Üí :3001

‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ modal.css          # Modais‚îÇ   ‚îî‚îÄ‚îÄ package.json

‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pagination.css     # Pagina√ß√£o e busca‚îÇ

‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ pages/‚îú‚îÄ‚îÄ referencia.html                    # HTML de refer√™ncia visual

‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ login.css          # P√°gina de login‚îú‚îÄ‚îÄ package.json

‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ cadastros.css      # P√°gina de cadastros‚îî‚îÄ‚îÄ README.MD

‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ lancamento.css     # P√°gina de lan√ßamento```

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/

‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ formatters.js          # CNPJ, moeda, data (com null guards)---

‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.jsx                    # Rotas protegidas por perfil

‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ main.jsx                   # Entry point + ToastContainer## üöÄ Como Rodar

‚îÇ   ‚îú‚îÄ‚îÄ dist/                          # Build de produ√ß√£o (servido pelo backend)

‚îÇ   ‚îú‚îÄ‚îÄ index.html### Pr√©-requisitos

‚îÇ   ‚îú‚îÄ‚îÄ vite.config.js                 # Proxy /api e /uploads ‚Üí :3001

‚îÇ   ‚îî‚îÄ‚îÄ package.json- **Node.js** >= 18

‚îÇ- **Docker Desktop** (para PostgreSQL)

‚îú‚îÄ‚îÄ referencia.html                    # HTML de refer√™ncia visual- **npm**

‚îú‚îÄ‚îÄ package.json

‚îî‚îÄ‚îÄ README.MD### 1. Banco de Dados (Docker)

```

```bash

---docker run --name hidroforte-postgres \

  -e POSTGRES_PASSWORD=hidroforte123 \

## üöÄ Como Rodar  -e POSTGRES_DB=hidroforte_erp \

  -p 5432:5432 \

### Pr√©-requisitos  -d postgres:16-alpine

```

- **Node.js** >= 18

- **Docker Desktop** (para PostgreSQL)> Para reiniciar ap√≥s reboot: `docker start hidroforte-postgres`

- **npm**

### 2. Backend

### 1. Banco de Dados (Docker)

```bash

```bashcd backend

docker run --name hidroforte-postgres \

  -e POSTGRES_PASSWORD=hidroforte123 \# Instalar depend√™ncias

  -e POSTGRES_DB=hidroforte_erp \npm install

  -p 5432:5432 \

  -d postgres:16-alpine# Configurar o .env

```# DATABASE_URL="postgresql://postgres:hidroforte123@localhost:5432/hidroforte_erp"

# JWT_SECRET="hidroforte-erp-secret-key-2026-mudar-em-producao"

> Para reiniciar ap√≥s reboot: `docker start hidroforte-postgres`# JWT_EXPIRES_IN="8h"

# PORT=3001

### 2. Backend

# Gerar Prisma Client + Criar tabelas + Seed

```bashnpm run setup

cd backend

# Iniciar servidor

# Instalar depend√™nciasnpm run dev        # development (com nodemon)

npm installnpm run start      # production

```

# Configurar o .env

# DATABASE_URL="postgresql://postgres:hidroforte123@localhost:5432/hidroforte_erp"O backend rodar√° em `http://localhost:3001`

# JWT_SECRET="hidroforte-erp-secret-key-2026-mudar-em-producao"

# JWT_EXPIRES_IN="8h"### 3. Frontend

# PORT=3001

```bash

# Gerar Prisma Client + Criar tabelas + Seed de usu√°rioscd frontend

npm run setup

# Instalar depend√™ncias

# Importar Centros de Custo + Contas Cont√°beis (seed unificado)npm install

node prisma/seedImportar.js

# Desenvolvimento

# Iniciar servidornpm run dev        # http://localhost:5173 (proxy para backend)

npm run dev        # development (com nodemon)

npm run start      # production# Build de produ√ß√£o (servido pelo backend)

```npm run build      # Gera ./dist

```

O backend rodar√° em `http://localhost:3001`



### 3. Frontend## üë§ Usu√°rios Padr√£o (Seed)



```bash| Perfil        | Email                          | Senha     |

cd frontend|---------------|--------------------------------|-----------|

| Administrador | admin@voltaris.com.br        | admin123  |

# Instalar depend√™ncias| Operador      | operador@voltaris.com.br     | admin123  |

npm install| Diretoria     | diretoria@voltaris.com.br    | admin123  |

| Financeiro    | financeiro@voltaris.com.br   | admin123  |

# Desenvolvimento

npm run dev        # http://localhost:5173 (proxy para backend)---



# Build de produ√ß√£o (servido pelo backend)## üîê Perfis e Permiss√µes (RBAC)

npm run build      # Gera ./dist

```| Perfil         | Descri√ß√£o                              | M√≥dulos                                              |

|----------------|----------------------------------------|------------------------------------------------------|

---| Administrador  | Gest√£o Total                           | Todos                                                |

| Operador       | Entrada de Dados                       | Dashboard, Cadastros, Lan√ßar Fatura, Financeiro      |

## üå± Seeds (Dados Iniciais)| Diretoria      | Valida√ß√£o T√©cnica/Estrat√©gica          | Dashboard, Aprova√ß√µes                                |

| Financeiro     | Fluxo de Caixa / Recebimento          | Dashboard, Pagamentos, Relat√≥rios                    |

### Usu√°rios (`seed.js`)

- Middleware `auth.middleware.js` valida JWT + verifica perfil em cada rota

Executado automaticamente via `npm run setup`.- Sidebar exibe apenas m√≥dulos permitidos para o perfil logado

- Rotas protegidas no frontend (React Router) e backend (Express middleware)

| Perfil        | Email                          | Senha     |

|---------------|--------------------------------|-----------|---

| Administrador | admin@hidroforte.com.br        | admin123  |

| Operador      | operador@hidroforte.com.br     | admin123  |## üìã Fluxo de Trabalho (Workflow)

| Diretoria     | diretoria@hidroforte.com.br    | admin123  |

| Financeiro    | financeiro@hidroforte.com.br   | admin123  |```

Operador lan√ßa fatura (PENDENTE)

### Centros de Custo + Contas Cont√°beis (`seedImportar.js`)        ‚Üì

Diretoria aprova/rejeita (APROVADA / REJEITADA)

Seed unificado que importa dados de dois arquivos JSON:        ‚Üì

Financeiro libera pagamento (LIBERADA)

| Fonte                    | Registros no JSON | √önicos importados | Observa√ß√£o                         |        ‚Üì

|--------------------------|-------------------|--------------------|-------------------------------------|Financeiro confirma baixa (PAGA)

| `Centro_de_custo.json`   | 748               | 748                | Chaves: `Classe` e string vazia    |```

| `contas_contabil.json`   | 538               | 278                | 260 duplicatas removidas por upsert |

Cada etapa registra:

- Utiliza `upsert` para evitar duplica√ß√£o em re-execu√ß√µes- **Quem** executou a a√ß√£o (usu√°rio respons√°vel)

- Campos importados: `numero` e `descricao`- **Quando** foi executada (timestamp)

- **IP** do solicitante

---- **Log de auditoria** completo no banco (tabela `audit_logs`)



## üîê Perfis e Permiss√µes (RBAC)---



| Perfil         | Descri√ß√£o                              | M√≥dulos                                              |## üìä M√≥dulos Detalhados

|----------------|----------------------------------------|------------------------------------------------------|

| Administrador  | Gest√£o Total                           | Todos                                                |### 1. üîë Login

| Operador       | Entrada de Dados                       | Dashboard, Cadastros, Lan√ßar Fatura, Financeiro      |- Autentica√ß√£o JWT com expira√ß√£o de 8h

| Diretoria      | Valida√ß√£o T√©cnica/Estrat√©gica          | Dashboard, Aprova√ß√µes                                |- Mensagens de erro espec√≠ficas:

| Financeiro     | Fluxo de Caixa / Recebimento          | Dashboard, Pagamentos, Relat√≥rios                    |  - "E-mail n√£o encontrado no sistema"

  - "Usu√°rio desativado. Contate o administrador"

- Middleware `auth.middleware.js` valida JWT + verifica perfil em cada rota  - "Senha incorreta"

- Sidebar exibe apenas m√≥dulos permitidos para o perfil logado- Exibi√ß√£o de erros inline + toast (React Toastify)

- Rotas protegidas no frontend (React Router) e backend (Express middleware)- Interceptor inteligente no Axios: s√≥ redireciona para login em 401 de token expirado (n√£o em falha de login)



---### 2. üìä Dashboard

- KPIs: total pendente, total pago, m√©dia kWh, faturas do m√™s

## üìã Fluxo de Trabalho (Workflow)- Gr√°ficos interativos com Chart.js:

  - Faturas por status (pizza)

```  - Valores por m√™s (barras)

Operador lan√ßa fatura (PENDENTE)

        ‚Üì### 3. üìù Cadastros (6 entidades)

Diretoria aprova/rejeita (APROVADA / REJEITADA)Cada entidade tem CRUD completo com listagem, busca, ativa√ß√£o/desativa√ß√£o:

        ‚Üì

Financeiro libera pagamento (LIBERADA)| Entidade              | Campos principais                                              |

        ‚Üì|-----------------------|----------------------------------------------------------------|

Financeiro confirma baixa (PAGA)| **Filiais**           | Raz√£o Social, CNPJ, Estado, Cidade                             |

```| **Fornecedores**      | Nome, CNPJ, Tipo de Pagamento, dados banc√°rios/PIX condicionais |

| **Unidades Consumidoras** | UC, N¬∫ Instala√ß√£o, Filial vinculada, Fornecedor vinculado   |

Cada etapa registra:| **Centros de Custo**  | N√∫mero, Descri√ß√£o                                               |

- **Quem** executou a a√ß√£o (usu√°rio respons√°vel)| **Contas Cont√°beis**  | N√∫mero, Descri√ß√£o                                               |

- **Quando** foi executada (timestamp)| **Naturezas**         | Descri√ß√£o                                                       |

- **IP** do solicitante

- **Log de auditoria** completo no banco (tabela `audit_logs`)#### Formul√°rio Condicional de Fornecedor

O campo **Tipo de Pagamento** controla quais campos s√£o exibidos:

---

| Tipo     | Campos exibidos                                    |

## üìä M√≥dulos Detalhados|----------|---------------------------------------------------|

| **TED**  | Banco, Ag√™ncia, Conta, Tipo de Conta, OP          |

### 1. üîë Login| **PIX**  | Tipo de Chave PIX, Chave PIX                       |

- Autentica√ß√£o JWT com expira√ß√£o de 8h| **Boleto** | Nenhum campo adicional (apenas informativo)      |

- Mensagens de erro espec√≠ficas:

  - "E-mail n√£o encontrado no sistema"### 4. üìÑ Lan√ßar Fatura

  - "Usu√°rio desativado. Contate o administrador"- **Split view**: visualizador de PDF √† esquerda + formul√°rio √† direita

  - "Senha incorreta"- Campos: UC, Filial (auto), Fornecedor (auto), Nota Fiscal, Valor, Leitura kWh, Vencimento, Refer√™ncia, Pedido de Compras, Centro de Custo, Conta Cont√°bil, Natureza

- Exibi√ß√£o de erros inline + toast (React Toastify)- **Forma de Pagamento** preenchida automaticamente do cadastro do fornecedor (readonly)

- Interceptor inteligente no Axios: s√≥ redireciona para login em 401 de token expirado (n√£o em falha de login)- **Aplica√ß√£o** (CAPEX / OPEX) como campo separado

- Upload de PDF da fatura e do pedido de compras (max 10MB cada)

### 2. üìä Dashboard

- KPIs: total pendente, total pago, m√©dia kWh, faturas do m√™s### 5. ‚úÖ Aprova√ß√µes

- Gr√°ficos interativos com Chart.js:- Fila de faturas pendentes para aprova√ß√£o

  - Faturas por status (pizza)- Visualiza√ß√£o de todos os detalhes + PDF anexo

  - Valores por m√™s (barras)- Op√ß√µes: Aprovar / Rejeitar (com motivo obrigat√≥rio)

- Acesso: Diretoria e Administrador

### 3. üìù Cadastros (6 entidades)

Cada entidade tem CRUD completo com listagem, busca, ativa√ß√£o/desativa√ß√£o:### 6. üí≥ Pagamentos

- Fila de faturas aprovadas para libera√ß√£o de pagamento

| Entidade              | Campos principais                                              |- Financeiro libera o pagamento

|-----------------------|----------------------------------------------------------------|- Acesso: Financeiro e Administrador

| **Filiais**           | Raz√£o Social, CNPJ, Estado, Cidade                             |

| **Fornecedores**      | Nome, CNPJ, Tipo de Pagamento, dados banc√°rios/PIX condicionais |### 7. üí∞ Financeiro / Baixas

| **Unidades Consumidoras** | UC, N¬∫ Instala√ß√£o, Filial vinculada, Fornecedor vinculado   |- Confirma√ß√£o final de pagamento (baixa)

| **Centros de Custo**  | N√∫mero, Descri√ß√£o                                               |- Registro de data e respons√°vel pela baixa

| **Contas Cont√°beis**  | N√∫mero, Descri√ß√£o                                               |- Acesso: Operador, Financeiro e Administrador

| **Naturezas**         | Descri√ß√£o                                                       |

### 8. üìà Relat√≥rios

#### Pagina√ß√£o Server-Side (C. Custo e Contas Cont√°beis)- **Log de auditoria**: todas as a√ß√µes do sistema com filtros

- Tabelas com grande volume de dados (748 e 278 registros) possuem **pagina√ß√£o server-side**- **Relat√≥rio de faturas**: filtros por status, per√≠odo, filial

- 20 registros por p√°gina com navega√ß√£o (anterior/pr√≥xima)- Acesso: Financeiro e Administrador

- **Busca com debounce** (400ms) para filtrar por n√∫mero ou descri√ß√£o

- Layout compacto em tabela (N√∫mero | Descri√ß√£o | A√ß√µes) diferente do layout em cards das demais entidades### 9. üë• Gest√£o de Usu√°rios

- Quando acessados por selects/dropdowns (sem par√¢metros de pagina√ß√£o), retornam a lista completa- CRUD de usu√°rios (criar, editar, ativar/desativar)

- Defini√ß√£o de perfil (ADMINISTRADOR, OPERADOR, DIRETORIA, FINANCEIRO)

#### Formul√°rio Condicional de Fornecedor- Acesso: Administrador apenas

O campo **Tipo de Pagamento** controla quais campos s√£o exibidos:

---

| Tipo     | Campos exibidos                                    |

|----------|---------------------------------------------------|## üìë Capa de Processo (Excel)

| **TED**  | Banco, Ag√™ncia, Conta, Tipo de Conta, OP          |

| **PIX**  | Tipo de Chave PIX, Chave PIX                       |Funcionalidade de gera√ß√£o autom√°tica de "Capa de Processo" em Excel a partir dos dados de uma fatura.

| **Boleto** | Nenhum campo adicional (apenas informativo)      |

### Como funciona:

### 4. üìÑ Lan√ßar Fatura1. Na tela de **Aprova√ß√µes** ou **Pagamentos**, ao revisar uma fatura, clique em **"Gerar Capa de Processo"**

- **Split view**: visualizador de PDF √† esquerda + formul√°rio √† direita2. O sistema l√™ o template Excel (`backend/templates/capa-processo-modelo.xlsx`)

- Campos: UC, Filial (auto), Fornecedor (auto), Nota Fiscal, Valor, Leitura kWh, Vencimento, Refer√™ncia, Pedido de Compras, Centro de Custo, Conta Cont√°bil, Natureza3. Preenche automaticamente os campos com dados da fatura:

- **Forma de Pagamento** preenchida automaticamente do cadastro do fornecedor (readonly)   - Dados do fornecedor (nome, CNPJ, dados banc√°rios/PIX)

- **Aplica√ß√£o** (CAPEX / OPEX) como campo separado   - Dados da fatura (valor, vencimento, forma de pagamento, aplica√ß√£o)

- Upload de PDF da fatura e do pedido de compras (max 10MB cada)   - Dados da filial e unidade consumidora

4. Retorna o arquivo Excel preenchido para download

### 5. ‚úÖ Aprova√ß√µes

- Fila de faturas pendentes para aprova√ß√£o### Endpoint:

- Bot√£o **"Visualizar Processo"** abre PDF unificado (Capa + Fatura + Pedido)```

- Op√ß√µes: Aprovar / Rejeitar (com motivo obrigat√≥rio)GET /api/faturas/:id/capa-processo

- Acesso: Diretoria e Administrador‚Üí Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet

```

### 6. üí≥ Pagamentos

- Fila de faturas aprovadas para libera√ß√£o de pagamento---

- Financeiro libera o pagamento

- Acesso: Financeiro e Administrador## üóÑÔ∏è Modelo de Dados (Prisma)



### 7. üí∞ Financeiro / Baixas### Enums

- Confirma√ß√£o final de pagamento (baixa)

- Registro de data e respons√°vel pela baixa| Enum          | Valores                                              |

- Acesso: Operador, Financeiro e Administrador|---------------|------------------------------------------------------|

| `Role`        | ADMINISTRADOR, OPERADOR, DIRETORIA, FINANCEIRO       |

### 8. üìà Relat√≥rios| `FaturaStatus`| PENDENTE, APROVADA, LIBERADA, PAGA, REJEITADA        |

- **Log de auditoria**: todas as a√ß√µes do sistema com filtros

- **Relat√≥rio de faturas**: filtros por status, per√≠odo, filial### Modelos (9 tabelas)

- Acesso: Financeiro e Administrador

| Modelo              | Tabela               | Descri√ß√£o                                |

### 9. üë• Gest√£o de Usu√°rios|---------------------|----------------------|------------------------------------------|

- CRUD de usu√°rios (criar, editar, ativar/desativar)| `User`              | `users`              | Usu√°rios do sistema                       |

- Defini√ß√£o de perfil (ADMINISTRADOR, OPERADOR, DIRETORIA, FINANCEIRO)| `Filial`            | `filiais`            | Filiais da empresa                        |

- Acesso: Administrador apenas| `Fornecedor`        | `fornecedores`       | Fornecedores (com dados banc√°rios/PIX)    |

| `UnidadeConsumidora`| `unidades_consumidoras` | Unidades consumidoras de energia       |

---| `CentroCusto`       | `centros_custo`      | Centros de custo cont√°beis               |

| `ContaContabil`     | `contas_contabeis`   | Contas cont√°beis                          |

## üìë Processo Completo (PDF Unificado)| `Natureza`          | `naturezas`          | Naturezas de despesa                      |

| `Fatura`            | `faturas`            | Faturas com workflow completo             |

Funcionalidade de visualiza√ß√£o integrada de todo o processo de uma fatura em um √∫nico PDF.| `AuditLog`          | `audit_logs`         | Log de auditoria de todas as a√ß√µes        |



### Como funciona:### Migra√ß√µes aplicadas:

1. Na tela de **Aprova√ß√µes** ou **Pagamentos**, ao revisar uma fatura, clique em **"Visualizar Processo"**1. `init` ‚Äî Estrutura base com todos os modelos

2. O backend gera o PDF completo server-side usando **pdf-lib**:2. `add_bank_fields_and_payment` ‚Äî Campos banc√°rios em Fornecedor + formaPagamento/aplica√ß√£o em Fatura

   - **Capa de Processo** ‚Äî gerada programaticamente com todos os dados da fatura (fornecedor, valores, dados banc√°rios/PIX, filial, UC, etc.)3. `add_tipo_pagamento_fornecedor` ‚Äî Campo tipoPagamento no Fornecedor

   - **PDF da Fatura** ‚Äî anexo original enviado pelo operador

   - **PDF do Pedido de Compras** ‚Äî anexo original enviado pelo operador---

3. Os tr√™s documentos s√£o mesclados em um √∫nico PDF

4. O PDF √© retornado como **base64 dentro de JSON** (`Content-Type: application/json`) para evitar intercepta√ß√£o por gerenciadores de download (IDM bypass)## üîå API Endpoints

5. O frontend decodifica o base64, cria um Blob e exibe em um visualizador fullscreen (`ProcessoViewer.jsx`)

### Autentica√ß√£o

### Capa de Processo ‚Äî Layout:| M√©todo | Rota              | Descri√ß√£o                    |

- Gerada com **pdf-lib** (StandardFonts.Helvetica / HelveticaBold)|--------|--------------------|------------------------------|

- Cabe√ßalho: "CAPA DE PROCESSO" + "SOLICITA√á√ÉO DE PAGAMENTO"| POST   | `/api/auth/login`  | Login (retorna JWT)          |

- Tabela com bordas uniformes (espessura 0.6pt, cor `rgb(0, 0, 0)`)| GET    | `/api/auth/me`     | Dados do usu√°rio logado      |

- Campos: Fornecedor, CNPJ, Forma de Pagamento, Banco, Ag√™ncia, Conta, Tipo de Conta, Chave PIX, Tipo Chave PIX, Valor, Compet√™ncia, Vencimento, Filial, UC, N¬∫ Instala√ß√£o, Aplica√ß√£o, Centro de Custo, Conta Cont√°bil, Nota Fiscal, Pedido de Compras, Observa√ß√µes

### Cadastros

### Endpoint:| M√©todo | Rota                        | Descri√ß√£o                    |

```|--------|-----------------------------|------------------------------|

GET /api/processo-completo/:faturaId| GET    | `/api/cadastros/:tipo`      | Listar (filiais, fornecedores, ucs, centros-custo, contas-contabeis, naturezas) |

‚Üí Content-Type: application/json| POST   | `/api/cadastros/:tipo`      | Criar                         |

‚Üí Body: { pdf: "<base64 string>" }| PUT    | `/api/cadastros/:tipo/:id`  | Atualizar                     |

```| PATCH  | `/api/cadastros/:tipo/:id/toggle` | Ativar/Desativar         |



---### Faturas

| M√©todo | Rota                               | Descri√ß√£o                    |

## üé® Arquitetura CSS (Modularizada)|--------|-------------------------------------|------------------------------|

| GET    | `/api/faturas`                      | Listar faturas               |

O CSS do projeto √© organizado em m√≥dulos para facilitar manuten√ß√£o e evitar conflitos:| POST   | `/api/faturas`                      | Lan√ßar nova fatura           |

| GET    | `/api/faturas/:id/capa-processo`    | Gerar Excel Capa de Processo |

```

styles/### Workflow

‚îú‚îÄ‚îÄ global.css              # Entry point ‚Äî @imports de todos os m√≥dulos| M√©todo | Rota                          | Descri√ß√£o                    |

‚îÇ                           # Cont√©m apenas: reset, vari√°veis CSS e :root|--------|-------------------------------|------------------------------|

‚îú‚îÄ‚îÄ processoViewer.css      # Estilos do visualizador fullscreen| PATCH  | `/api/workflow/:id/aprovar`   | Aprovar fatura               |

‚îú‚îÄ‚îÄ components/| PATCH  | `/api/workflow/:id/rejeitar`  | Rejeitar fatura              |

‚îÇ   ‚îú‚îÄ‚îÄ sidebar.css         # Sidebar, nav links, logo| PATCH  | `/api/workflow/:id/liberar`   | Liberar pagamento            |

‚îÇ   ‚îú‚îÄ‚îÄ cards.css           # Cards de listagem (.card, .card-header)| PATCH  | `/api/workflow/:id/baixar`    | Confirmar baixa/pagamento    |

‚îÇ   ‚îú‚îÄ‚îÄ tabs.css            # Abas de navega√ß√£o (.tabs-container)

‚îÇ   ‚îú‚îÄ‚îÄ forms.css           # Inputs, labels, form-group, form-row### Dashboard

‚îÇ   ‚îú‚îÄ‚îÄ buttons.css         # .btn, .btn-primary, .btn-danger, etc.| M√©todo | Rota                    | Descri√ß√£o                    |

‚îÇ   ‚îú‚îÄ‚îÄ tables.css          # .cadastro-table, table thead/tbody|--------|-------------------------|------------------------------|

‚îÇ   ‚îú‚îÄ‚îÄ badges.css          # .badge, .badge-ativo, .badge-inativo| GET    | `/api/dashboard/kpis`   | KPIs (totais e m√©dias)       |

‚îÇ   ‚îú‚îÄ‚îÄ modal.css           # .modal-overlay, .modal-content| GET    | `/api/dashboard/charts` | Dados para gr√°ficos          |

‚îÇ   ‚îî‚îÄ‚îÄ pagination.css      # .pagination-bar, .search-bar, .search-input-wrap

‚îî‚îÄ‚îÄ pages/### Relat√≥rios

    ‚îú‚îÄ‚îÄ login.css           # .login-container, .login-card| M√©todo | Rota                          | Descri√ß√£o                    |

    ‚îú‚îÄ‚îÄ cadastros.css       # .page-header, .list-header|--------|-------------------------------|------------------------------|

    ‚îî‚îÄ‚îÄ lancamento.css      # .lancamento-container, .split-view| GET    | `/api/relatorios/auditoria`   | Log de auditoria             |

```| GET    | `/api/relatorios/faturas`     | Relat√≥rio de faturas         |



- `global.css` importa todos os m√≥dulos via `@import`### Usu√°rios

- Cada m√≥dulo √© independente e respons√°vel por um √∫nico conceito visual| M√©todo | Rota                              | Descri√ß√£o                    |

- Build final (Vite): ~27 KB de CSS otimizado|--------|-----------------------------------|------------------------------|

| GET    | `/api/users`                      | Listar usu√°rios              |

---| POST   | `/api/users`                      | Criar usu√°rio                |

| PUT    | `/api/users/:id`                  | Atualizar usu√°rio            |

## üóÑÔ∏è Modelo de Dados (Prisma)| PATCH  | `/api/users/:id/toggle`           | Ativar/Desativar             |



### Enums### Utilit√°rios

| M√©todo | Rota              | Descri√ß√£o                    |

| Enum          | Valores                                              ||--------|--------------------|------------------------------|

|---------------|------------------------------------------------------|| GET    | `/api/health`      | Health check do servidor     |

| `Role`        | ADMINISTRADOR, OPERADOR, DIRETORIA, FINANCEIRO       |

| `FaturaStatus`| PENDENTE, APROVADA, LIBERADA, PAGA, REJEITADA        |---



### Modelos (9 tabelas)## üõ°Ô∏è Seguran√ßa



| Modelo              | Tabela               | Descri√ß√£o                                |- **JWT** com secret configur√°vel e expira√ß√£o de 8h

|---------------------|----------------------|------------------------------------------|- **bcryptjs** para hash de senhas (salt rounds: 10)

| `User`              | `users`              | Usu√°rios do sistema                       |- **RBAC** (Role-Based Access Control) em todas as rotas

| `Filial`            | `filiais`            | Filiais da empresa                        |- **Interceptor Axios inteligente**: redireciona para login apenas em 401 de token expirado (ignora erros de autentica√ß√£o na tela de login)

| `Fornecedor`        | `fornecedores`       | Fornecedores (com dados banc√°rios/PIX)    |- **Valida√ß√£o** de dados no backend com express-validator

| `UnidadeConsumidora`| `unidades_consumidoras` | Unidades consumidoras de energia       |- **Upload seguro**: apenas PDFs, limite de 10MB

| `CentroCusto`       | `centros_custo`      | Centros de custo cont√°beis               |- **Auditoria completa**: toda a√ß√£o registrada com usu√°rio, IP e timestamp

| `ContaContabil`     | `contas_contabeis`   | Contas cont√°beis                          |

| `Natureza`          | `naturezas`          | Naturezas de despesa                      |---

| `Fatura`            | `faturas`            | Faturas com workflow completo             |

| `AuditLog`          | `audit_logs`         | Log de auditoria de todas as a√ß√µes        |## üêõ Corre√ß√µes e Melhorias Implementadas



### Migra√ß√µes aplicadas:### Formul√°rio Condicional de Fornecedor

1. `init` ‚Äî Estrutura base com todos os modelos- Campos de pagamento exibidos condicionalmente baseado no tipo (TED/PIX/BOLETO)

2. `add_bank_fields_and_payment` ‚Äî Campos banc√°rios em Fornecedor + formaPagamento/aplica√ß√£o em Fatura- Dados limpos automaticamente ao trocar tipo de pagamento

3. `add_tipo_pagamento_fornecedor` ‚Äî Campo tipoPagamento no Fornecedor- Forma de pagamento auto-preenchida na fatura a partir do cadastro do fornecedor



---### Capa de Processo (Excel)

- Gera√ß√£o autom√°tica de Excel preenchido a partir de template

## üîå API Endpoints- Preenchimento de dados do fornecedor, fatura e unidade consumidora

- Download direto pelo navegador via blob

### Autentica√ß√£o

| M√©todo | Rota              | Descri√ß√£o                    |### Mensagens de Erro no Login

|--------|--------------------|------------------------------|- Backend retorna mensagens espec√≠ficas (email n√£o encontrado, usu√°rio desativado, senha incorreta)

| POST   | `/api/auth/login`  | Login (retorna JWT)          |- Frontend exibe erros inline (caixa vermelha) + toast notification

| GET    | `/api/auth/me`     | Dados do usu√°rio logado      |- **Corre√ß√£o do toast sumindo**: interceptor 401 do Axios agora ignora requisi√ß√µes de login, evitando redirect que destru√≠a o toast



### Cadastros### Produ√ß√£o / Deploy

| M√©todo | Rota                        | Descri√ß√£o                    |- Backend serve o build do frontend (`frontend/dist`) em produ√ß√£o

|--------|-----------------------------|------------------------------|- Rota wildcard `app.get('*')` serve `index.html` para SPA routing

| GET    | `/api/cadastros/:tipo`      | Listar (filiais, fornecedores, ucs, centros-custo, contas-contabeis, naturezas) |- Acesso externo via localtunnel sem necessidade de configura√ß√£o de rede

| GET    | `/api/cadastros/:tipo?page=1&limit=20&search=texto` | Listar com pagina√ß√£o e busca |

| POST   | `/api/cadastros/:tipo`      | Criar                         |---

| PUT    | `/api/cadastros/:tipo/:id`  | Atualizar                     |

| PATCH  | `/api/cadastros/:tipo/:id/toggle` | Ativar/Desativar         |## ‚öôÔ∏è Vari√°veis de Ambiente (.env)



> **Nota:** Quando `page`, `limit` ou `search` s√£o informados, o retorno √© `{ data: [], pagination: { page, limit, total, totalPages } }`. Sem esses par√¢metros, retorna o array completo (usado por selects/dropdowns).```env

DATABASE_URL="postgresql://postgres:hidroforte123@localhost:5432/hidroforte_erp"

### FaturasJWT_SECRET="hidroforte-erp-secret-key-2026-mudar-em-producao"

| M√©todo | Rota                               | Descri√ß√£o                    |JWT_EXPIRES_IN="8h"

|--------|-------------------------------------|------------------------------|PORT=3001

| GET    | `/api/faturas`                      | Listar faturas               |```

| POST   | `/api/faturas`                      | Lan√ßar nova fatura           |

---

### Processo Completo (PDF)

| M√©todo | Rota                                    | Descri√ß√£o                    |## üîÆ Pr√≥ximos Passos (Planejado)

|--------|-----------------------------------------|------------------------------|

| GET    | `/api/processo-completo/:faturaId`      | PDF unificado (Capa + Fatura + Pedido) em base64 |- [ ] Exporta√ß√£o de relat√≥rios para Excel/PDF

- [ ] Notifica√ß√µes por email (aprova√ß√£o, rejei√ß√£o, pagamento)

### Workflow- [ ] Dashboard avan√ßado com filtros por per√≠odo/filial

| M√©todo | Rota                          | Descri√ß√£o                    |- [ ] Integra√ß√£o com sistemas de pagamento banc√°rio

|--------|-------------------------------|------------------------------|- [ ] M√∫ltiplos anexos por fatura

| PATCH  | `/api/workflow/:id/aprovar`   | Aprovar fatura               |- [ ] Hist√≥rico de altera√ß√µes em cadastros

| PATCH  | `/api/workflow/:id/rejeitar`  | Rejeitar fatura              |- [ ] Modo escuro (dark theme)

| PATCH  | `/api/workflow/:id/liberar`   | Liberar pagamento            |- [ ] Relat√≥rios gr√°ficos por fornecedor e centro de custo

| PATCH  | `/api/workflow/:id/baixar`    | Confirmar baixa/pagamento    |

---

### Dashboard

| M√©todo | Rota                    | Descri√ß√£o                    |## üìù Licen√ßa

|--------|-------------------------|------------------------------|

| GET    | `/api/dashboard/kpis`   | KPIs (totais e m√©dias)       |Projeto propriet√°rio - Hidroforte ¬© 2026

| GET    | `/api/dashboard/charts` | Dados para gr√°ficos          |

### Relat√≥rios
| M√©todo | Rota                          | Descri√ß√£o                    |
|--------|-------------------------------|------------------------------|
| GET    | `/api/relatorios/auditoria`   | Log de auditoria             |
| GET    | `/api/relatorios/faturas`     | Relat√≥rio de faturas         |

### Usu√°rios
| M√©todo | Rota                              | Descri√ß√£o                    |
|--------|-----------------------------------|------------------------------|
| GET    | `/api/users`                      | Listar usu√°rios              |
| POST   | `/api/users`                      | Criar usu√°rio                |
| PUT    | `/api/users/:id`                  | Atualizar usu√°rio            |
| PATCH  | `/api/users/:id/toggle`           | Ativar/Desativar             |

### Utilit√°rios
| M√©todo | Rota              | Descri√ß√£o                    |
|--------|--------------------|------------------------------|
| GET    | `/api/health`      | Health check do servidor     |

---

## üõ°Ô∏è Seguran√ßa

- **JWT** com secret configur√°vel e expira√ß√£o de 8h
- **bcryptjs** para hash de senhas (salt rounds: 10)
- **RBAC** (Role-Based Access Control) em todas as rotas
- **Interceptor Axios inteligente**: redireciona para login apenas em 401 de token expirado (ignora erros de autentica√ß√£o na tela de login)
- **Valida√ß√£o** de dados no backend com express-validator
- **Upload seguro**: apenas PDFs, limite de 10MB
- **Auditoria completa**: toda a√ß√£o registrada com usu√°rio, IP e timestamp
- **IDM bypass**: PDFs retornados como base64 em JSON para evitar intercepta√ß√£o

---

## üêõ Corre√ß√µes e Melhorias Implementadas

### v2.0.0 (Fevereiro 2026)

#### üìë PDF Unificado (Processo Completo)
- Substitui√ß√£o do Excel (ExcelJS) por **pdf-lib** para gera√ß√£o da Capa de Processo
- Unifica√ß√£o de 3 bot√µes separados (Capa, Fatura, Pedido) em √∫nico bot√£o **"Visualizar Processo"**
- Mesclagem server-side dos 3 PDFs em documento √∫nico
- Retorno via base64 JSON para **bypass de IDM** (Internet Download Manager)
- Visualizador fullscreen dedicado (`ProcessoViewer.jsx`)

#### üé® CSS Modularizado
- Refatora√ß√£o do `global.css` de **961 ‚Üí 170 linhas** (entry point com `@import`)
- Cria√ß√£o de **12 m√≥dulos CSS** organizados em `components/` e `pages/`
- Build otimizado mantido em ~27 KB

#### üìÑ Pagina√ß√£o Server-Side
- Centros de Custo (748 registros) e Contas Cont√°beis (278 registros) com pagina√ß√£o
- 20 itens por p√°gina com busca debounce (400ms)
- Layout compacto em tabela para grandes volumes de dados
- API retorna formato paginado ou completo conforme par√¢metros

#### üå± Seed Unificado
- `seedImportar.js` importa C. Custo + Contas Cont√°beis de arquivos JSON
- Upsert previne duplica√ß√£o em re-execu√ß√µes
- Tratamento de 260 registros duplicados no JSON de contas cont√°beis

#### üîß Corre√ß√µes de Bugs
- **formatCNPJ / validarCNPJ**: adicionados null guards (`if (!value) return ''` e `String(value)`) para evitar `Cannot read properties of undefined`
- **Capa de Processo**: bordas uniformes com espessura 0.6pt e fun√ß√£o `line()` unificada
- **Campos divididos**: CONTA/TIPO DE CONTA e CHAVE PIX/TIPO CHAVE PIX separados em linhas individuais

### v1.0.0 (Fevereiro 2026)

#### Formul√°rio Condicional de Fornecedor
- Campos de pagamento exibidos condicionalmente baseado no tipo (TED/PIX/BOLETO)
- Dados limpos automaticamente ao trocar tipo de pagamento
- Forma de pagamento auto-preenchida na fatura a partir do cadastro do fornecedor

#### Mensagens de Erro no Login
- Backend retorna mensagens espec√≠ficas (email n√£o encontrado, usu√°rio desativado, senha incorreta)
- Frontend exibe erros inline (caixa vermelha) + toast notification
- **Corre√ß√£o do toast sumindo**: interceptor 401 do Axios agora ignora requisi√ß√µes de login

#### Produ√ß√£o / Deploy
- Backend serve o build do frontend (`frontend/dist`) em produ√ß√£o
- Rota wildcard `app.get('*')` serve `index.html` para SPA routing
- Acesso externo via localtunnel sem necessidade de configura√ß√£o de rede

---

## ‚öôÔ∏è Vari√°veis de Ambiente (.env)

```env
DATABASE_URL="postgresql://postgres:hidroforte123@localhost:5432/hidroforte_erp"
JWT_SECRET="hidroforte-erp-secret-key-2026-mudar-em-producao"
JWT_EXPIRES_IN="8h"
PORT=3001
```

---

## üîÆ Pr√≥ximos Passos (Planejado)

- [ ] Exporta√ß√£o de relat√≥rios para Excel/PDF
- [ ] Notifica√ß√µes por email (aprova√ß√£o, rejei√ß√£o, pagamento)
- [ ] Dashboard avan√ßado com filtros por per√≠odo/filial
- [ ] Integra√ß√£o com sistemas de pagamento banc√°rio
- [ ] M√∫ltiplos anexos por fatura
- [ ] Hist√≥rico de altera√ß√µes em cadastros
- [ ] Modo escuro (dark theme)
- [ ] Relat√≥rios gr√°ficos por fornecedor e centro de custo

---

## üìù Licen√ßa

Projeto propriet√°rio - Hidroforte ¬© 2026
